//Скрипт для Бургер меню ==========================

const burger = document.querySelector('.menu__burger');
const menuNav = document.querySelector('.menu__main');

function show(classItem, clickItem, element) {
   if(clickItem.classList.contains(classItem)) {
      clickItem.classList.remove(classItem);
      element.classList.remove(classItem);
   } else {
      clickItem.classList.add(classItem);
      element.classList.add(classItem);
   }
}

function category_change_view(changeSavedState) {
   show('show',burger,menuNav);
   checkWrapper();
   smallMenu.classList.toggle('menu__small-hide');

   if (changeSavedState) {
      let new_show_menu_value_value = localStorage.getItem('show_full_menu') === 'true' ? 'false' : 'true';
      localStorage.setItem('show_full_menu', new_show_menu_value_value);
   }
}

burger.addEventListener('click', () => {
   category_change_view(true);
});
const smallCategory = document.querySelector('.menu__small-category');
const smallWrapper = document.querySelector('.main__container-wrapper');
const smallMenu = document.querySelector('.menu__small');

smallCategory.addEventListener('click', () => {
   category_change_view(true);
});
smallWrapper.addEventListener('click', () => {
   category_change_view(true);
});

function checkWrapper() {
   if(burger.classList.contains('show')) {
      smallWrapper.classList.add('main__container-wrapper-active');
   } else {
      smallWrapper.classList.remove('main__container-wrapper-active');
   }
}

if (localStorage.getItem('show_full_menu') === 'true') {
   category_change_view(false);
}

try {
   //Всплывающие меню
   const notificationModal = document.querySelector('.social-notification'),
   messageModal = document.querySelector('.social-message'),
   profileModal = document.querySelector('.header__menu'),
   // alarm = document.querySelector('.header__alarm'),
   // message = document.querySelector('.header__message'),
   profile = document.querySelector('.header__profile'),
   // menuArray = [alarm,message,profile],
   menuArray = [profile],
   menuArrayModal = [notificationModal,messageModal,profileModal];

   menuArray.forEach((element) => {
   element.addEventListener('click',function() {

   let i;
   // if (element == alarm) {
   //    clearShow();
   //    i = notificationModal;
   //    show('showModal',element,i);
   // }
   // if (element == message) {
   //    clearShow();
   //    i = messageModal;
   //    show('showModal',element,i);
   // }
   if (element == profile) {
      clearShow();
      i = profileModal;
      show('showModal',element,i);
   }
   });
   });

   function clearShow() {
      menuArrayModal.forEach((item) => {
         if (item.classList.contains('showModal')) {
            item.classList.remove('showModal');
         }
      });
   }
}
catch {

}

const dropdownParants = document.querySelectorAll('.dropdown__parent'),
      dropdowns = document.querySelectorAll('.dropdown');

dropdownParants.forEach((element) => {
   let dropdownNameElement = element.querySelector('.dropdown__name');

   dropdownNameElement.addEventListener('click', function() {
      dropdownNameElement.classList.toggle('dropdown__name-active');
      element.querySelectorAll('.dropdown').forEach((item) => {
          // костыль предотвращающий рекурсивное разварачивание элементов
          if (item.parentElement == element) {
              item.classList.toggle('show__drop');
          }
      });

      return false;
   });
});


try{
   function parallax(event) {
      this.querySelectorAll('.modal__layer').forEach(layer => {
         layer.style.transform = `translateX(${event.clientX/50}px)`;
      });
   }
   
   document.addEventListener('mousemove', parallax);
   
   
   const comments = document.querySelectorAll('.comments__fluid');
   
   comments.forEach((e) => {
      let hideItems = e.querySelectorAll('.comments__hide');
      hideItems.forEach((element) => {
         element.addEventListener('click', function() {
            showHide(element);
            let comments = e.querySelector('.comments__answer');
            hideMessage(comments);
         });
      });
   
      function showHide(element) {
         element.classList.toggle('show__hide');
      }
      function hideMessage(item) {
         item.classList.toggle('comments__none');
      }
   });

   document.querySelectorAll('.comments__button').forEach((e) => {
      e.addEventListener('click', function() {
         let fluid = this.parentElement.parentElement.parentElement;
         let row = this.parentElement;
         if (!this.classList.contains('push')) {
            this.classList.add('push');
            fluid.insertAdjacentHTML('beforeend', ' <div class="comments__add"><textarea class="comments__textarea" name="comment" id="" cols="30" rows="10" placeholder="Напишите комментарий"></textarea></div>');
            row.insertAdjacentHTML('beforeend', '<button class="button comments__button" >Отправить</button>');
         }
      });
   });
   
}
catch{
   
}
